# WHU-ComputerOrganizationDesign-lab
## 概述
***武汉大学计算机学院 计算机组成原理课程设计攻略***   **riscv版**<br>
<br>
**注：本文是基于23spring的课设写的，之后的课设可能有一些地方不一样，如果在23spring之后看到这篇文章，建议还是仔细阅读一下。**<br>
<br>
从2023 spring 开始，这门课程要求使用Verilog实现三个包括riscv指令集中部分指令的CPU。这三个CPU是单周期CPU，不带冒险检测的流水线CPU和带冒险检测与处理的流水线CPU。<br>
<br>
本仓库中的代码为完整的三个CPU的Verilog代码，附带一个教程和说明以方便读者~~应付~~通过验收时的提问。*（多说几句，这课程设计纯属逆天，上课什么都不说，丢给好多东西自己去写，又浪费时间又浪费精力，还有那个实验报告，按着那个基本框架都能写到1.5万字以上，特别提名某x姓老师）*<br>
## 指令集/机器码/汇编程序
这里就具体看老师要求实现什么语句，并且看他想怎么编这些语句的机器码了，比如xxb的要求是Task1中的20条汇编，对应的机器码的方法也有他自己的做法。**注意：不同老师大概了不一样，比如我知道的fj班就使用了另一系列指令/机器码，这个写后面的模块大概率会用到，所以不同班很难一起做。**<br>
<br>
其他就没有什么特别好说的，**翻译转换一般需要自己做**，而且确实建议自己来，收别人的可能会有错，那样可能后来试功能的时候不知道哪里错了，就很麻烦。然后有时间的话可以去读读他写的汇编程序，看看具体的流程，这个有助于后来差错，（我这里的都是完全对的，等以后你们看看他要求有没有变化，做对应的修改就行了）没时间的话就直接看看对应的功能描述差不多就行了。<br>
<br>
最后说说他大概怎么验收，他会要求设置两个频率，一个快clk频率，会马上算出来结果，所以他会用这个看结果，一个慢clk频率，他用这个看PC地址显示。所以其实是四种组合：快clk+PC地址，快clk+结果，慢clk+PC地址，慢clk+结果，拨快/慢clk和PC地址/结果的代码在顶层模块里面，是分别用了一个开关控制的，具体是哪个开关我忘记了，大家打开代码差不多一看就知道了。<br>
## 单周期CPU
总体思路就是先写好每个模块的功能，然后拿一个顶层文件连起来就行，每个模块的代码我都上传了，对应的原理图在[Task文件夹里面](https://github.com/bryceyin13/WHU-ComputerOrganizationDesign-lab/blob/main/Task/Task2%20SingleCycleCPU.pdf)。这个对应的汇编程序是第一个，求1-100的加和，然后放到r31显示，快clk显示的结果就是13ba（16禁止的5050），慢clk是先是0，**过一段时间之后显示13ba**。他可能会看一个PC地址，这个因为是单周期，先开始是前面循环加和，最后PC地址会停在最后一条指令的位置，**我记得是一直显示9**（直接拨快clk只能看到9，因为前面PC地址的变化闪的太快，看不清的）。
## 基本的流水线CPU
基本流水线CPU是在单周期的基础上加了流水线寄存器的模块，具体需要有什么输入输出我写到代码里了，有兴趣有时间的大佬可以看看。原理图也在Task里面。这个对应的汇编程序是一个冒泡排序，很长，我也没完全看懂，但是他这个意思是对内存那个模块（DMem）里面的数组（RAM，模拟的就是内存的存储块）的0-9号位置先初始化成10-1，然后排序成1-10再输出。具体程序细节要去看他的汇编代码了，**显示的结果是一个1-a（hex）的递增序列，如果直接拨快频率的话就只能看到a，这个建议拨慢频率看。**<br>
<br>
因为是流水线，PC地址在前面来会来回循环排序，最后会循环显示4个PC地址，没记错的话是78，79，80，81（hex是4e，4f，50，51）这个是因为这个CPU输出的PC地址是直接输出Imem那里的，然后他停止等待的汇编程序是用一个beq实现的（if 0==0，跳转回自己），在MEM级决定是不是跳转并且修改PC地址，所以放入IMem（对应大二上学的计组课这个模块是在IF级）的指令地址就是beq，beq下一条，beq下下一条，beq下下下一条（这个地方beq那条指令走到了MEM级，修改了要装入IF级/IMem的PC地址为beq的地址），beq的地址，之后继续循环，所以是这样显示的。**（这里是我给解释一下原理，大家没时间也不用搞懂，大概率他验收的时候也不问这个，这个地方我验收的时候他只看了结果的1-10）**。<br>
<br>
**最后多说一句，直接拨快clk看到的PC地址是类似于一个“98”的，不过仔细看会发现有的显示管会更亮，有的更暗，这个是因为4e-51这四个数高速循环，亮的地方是这四个数都要亮的数码管，暗的地方是这几个数字中有的要亮，有的不要亮的数码管。**<br>
## 完整的流水线CPU
完整流水线CPU就是在第二个的基础上加了**四个检测冒险的模块**，并不复杂。对应的汇编程序是求斐波那契数列，他给的汇编程序里面有几条的顺序需要改一下，具体哪几条我不记得了，想知道的话可以去[这个文件里面](https://github.com/bryceyin13/WHU-ComputerOrganizationDesign-lab/blob/main/Final_Pipeline/IMem.v)找我最后验收时用的汇编代码，和他给的[这个文件](https://github.com/bryceyin13/WHU-ComputerOrganizationDesign-lab/blob/main/Task/Task1%20%E6%8C%87%E4%BB%A4%E7%B3%BB%E7%BB%9F%E4%B8%8E%E9%AA%8C%E8%AF%81%E7%A8%8B%E5%BA%8F%E8%AF%BE%E5%A0%82%E7%94%A8.pdf)里面的第三个程序的汇编对照，不想知道就算了，也关系不大（这个不知道是他故意的还是不小心的，反正我当时一点一点按那个汇编代码在纸上模拟了几遍过程才找出来问题）。**这个程序数值显示结果是15（hex of 21），PC地址也是几个值在一直循环，和第二个原理一样，就不多说了。**
## 结尾
最后的最后还是很想吐槽一下这个课，本来大部分课设都没用，这个更是感觉又没用又非常浪费时间，真的很讨厌这种的课设。。。。。。
